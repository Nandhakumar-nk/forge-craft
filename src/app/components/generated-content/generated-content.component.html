<div *ngIf="epic" class="bg-white rounded-xl shadow-lg p-6" [formGroup]="epicForm">
  <h2 class="text-xl font-semibold text-fuchsia-600 m-2">Review & Edit Generated Content</h2>
  <app-tabs>

  <app-tabs-list>
    <app-tabs-trigger value="epic" [isActive]="activeTab  === 'epic'" (tabSelected)="onTabSelect($event)"
      >Epic</app-tabs-trigger>
    <app-tabs-trigger value="stories" [isActive]="activeTab  === 'stories'" (tabSelected)="onTabSelect($event)">User Stories</app-tabs-trigger>
    <app-tabs-trigger value="tests" [isActive]="activeTab  === 'tests'" (tabSelected)="onTabSelect($event)">Test Cases</app-tabs-trigger>
  </app-tabs-list>

    <app-tabs-content value="epic" [isActive]="activeTab === 'epic'">
      <div class="space-y-4 p-4 bg-white rounded-lg border-2 border-blue-100">
        <div>
          <label class="block text-indigo-600 font-semibold mb-2">Epic Title</label>
          <input formControlName="title"
          class="w-full p-3 border-2 rounded-lg" />
        </div>
        <div>
          <label class="block text-indigo-600 font-semibold mb-2">Epic Description</label>
          <textarea formControlName="description" class="w-full p-3 border-2 rounded-lg"></textarea>
        </div>
      </div>
    </app-tabs-content>

    <app-tabs-content value="stories" [isActive]="activeTab  === 'stories'" formArrayName="stories">
      <div class="space-y-4 p-4 bg-white rounded-lg border-2 border-blue-100" [formGroupName]="0">
        <div>
          <label class="block text-indigo-600 font-semibold mb-2">Story Title</label>
          <input formControlName="title"
          class="w-full p-3 border-2 rounded-lg" />
        </div>
        <div>
          <label class="block text-indigo-600 font-semibold mb-2">Description</label>
          <textarea formControlName="description" class="w-full p-3 border-2 rounded-lg"></textarea>
        </div>
        <div formArrayName="acceptanceCriteria">
          <label class="block text-indigo-600 font-semibold mb-2">Acceptance Criteria</label>
          <div
          *ngFor="let criteria of getAcceptanceCriteria(0).controls; let j = index"
        style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
          <span class="text-indigo-600 font-semibold">{{j+1}}.</span> <input [formControlName]="j"
          class="w-full p-2 border-2 rounded-lg m-1" />
          <div class="relative group">          
          <button type="button" (click)="removeAcceptanceCriteria(0, j)" class="text-red-600 font-semibold hover:text-red-700">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0,0,256,256">
              <g fill="#dc0000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M21,0c-1.64453,0 -3,1.35547 -3,3v2h-7.8125c-0.125,-0.02344 -0.25,-0.02344 -0.375,0h-1.8125c-0.03125,0 -0.0625,0 -0.09375,0c-0.55078,0.02734 -0.98047,0.49609 -0.95312,1.04688c0.02734,0.55078 0.49609,0.98047 1.04688,0.95313h1.09375l3.59375,40.5c0.125,1.39844 1.31641,2.5 2.71875,2.5h19.1875c1.40234,0 2.59375,-1.10156 2.71875,-2.5l3.59375,-40.5h1.09375c0.35938,0.00391 0.69531,-0.18359 0.87891,-0.49609c0.17969,-0.3125 0.17969,-0.69531 0,-1.00781c-0.18359,-0.3125 -0.51953,-0.5 -0.87891,-0.49609h-10v-2c0,-1.64453 -1.35547,-3 -3,-3zM21,2h8c0.5625,0 1,0.4375 1,1v2h-10v-2c0,-0.5625 0.4375,-1 1,-1zM11.09375,7h27.8125l-3.59375,40.34375c-0.03125,0.34766 -0.40234,0.65625 -0.71875,0.65625h-19.1875c-0.31641,0 -0.6875,-0.30859 -0.71875,-0.65625zM18.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953zM24.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953zM30.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953z"></path></g></g>
              </svg>
          </button>
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2">
            Delete
          </div>
        </div>
        </div>
        <button
        class="m-2 bg-gradient-to-r from-pink-600 to-pink-600 hover:from-fuchsia-700 hover:to-pink-700 text-white font-semibold py-2 px-4 rounded-lg transition-all shadow-lg hover:shadow-xl"
        (click)="addAcceptanceCriteria(0)"
        >
        + Add Acceptance Criteria
      </button>
        </div>

      </div>
      <button
      class="w-full m-2 bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 text-white font-semibold py-3 px-2 rounded-lg"
      (click)="addUserStory()"
      >
      + Add User Story
    </button>
    </app-tabs-content>

    <app-tabs-content value="tests" [isActive]="activeTab  === 'tests'">
        <label class="block text-indigo-600 font-semibold mb-2">Test cases</label>

        <div
        *ngFor="let criteria of getTestCases(0).controls; let k = index"
      style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
        <span class="text-indigo-600 font-semibold">{{k+1}}.</span> <input [formControlName]="k"
        class="w-full p-2 border-2 rounded-lg m-1" />
        
        <div class="relative group">          
          <button type="button" (click)="removeTestCase(0, k)" class="text-red-600 font-semibold hover:text-red-700">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0,0,256,256">
              <g fill="#dc0000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M21,0c-1.64453,0 -3,1.35547 -3,3v2h-7.8125c-0.125,-0.02344 -0.25,-0.02344 -0.375,0h-1.8125c-0.03125,0 -0.0625,0 -0.09375,0c-0.55078,0.02734 -0.98047,0.49609 -0.95312,1.04688c0.02734,0.55078 0.49609,0.98047 1.04688,0.95313h1.09375l3.59375,40.5c0.125,1.39844 1.31641,2.5 2.71875,2.5h19.1875c1.40234,0 2.59375,-1.10156 2.71875,-2.5l3.59375,-40.5h1.09375c0.35938,0.00391 0.69531,-0.18359 0.87891,-0.49609c0.17969,-0.3125 0.17969,-0.69531 0,-1.00781c-0.18359,-0.3125 -0.51953,-0.5 -0.87891,-0.49609h-10v-2c0,-1.64453 -1.35547,-3 -3,-3zM21,2h8c0.5625,0 1,0.4375 1,1v2h-10v-2c0,-0.5625 0.4375,-1 1,-1zM11.09375,7h27.8125l-3.59375,40.34375c-0.03125,0.34766 -0.40234,0.65625 -0.71875,0.65625h-19.1875c-0.31641,0 -0.6875,-0.30859 -0.71875,-0.65625zM18.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953zM24.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953zM30.90625,9.96875c-0.04297,0.00781 -0.08594,0.01953 -0.125,0.03125c-0.46484,0.10547 -0.79297,0.52344 -0.78125,1v33c-0.00391,0.35938 0.18359,0.69531 0.49609,0.87891c0.3125,0.17969 0.69531,0.17969 1.00781,0c0.3125,-0.18359 0.5,-0.51953 0.49609,-0.87891v-33c0.01172,-0.28906 -0.10547,-0.56641 -0.3125,-0.76172c-0.21094,-0.19922 -0.49609,-0.29687 -0.78125,-0.26953z"></path></g></g>
              </svg>
          </button>
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2">
            Delete
          </div>
        </div>
      </div>
      <button
      class="m-2 bg-gradient-to-r from-pink-600 to-pink-600 hover:from-fuchsia-700 hover:to-pink-700 text-white font-semibold py-2 px-4 rounded-lg transition-all shadow-lg hover:shadow-xl"
      (click)="addTestCase(0)"
      >
      + Add Test Case
    </button>
    </app-tabs-content>
</app-tabs>
  <button
  click="submitEpic()"
  [disabled]="isSubmitting$ | async"
  class="w-full m-2 bg-gradient-to-r from-indigo-600 via-purple-600 to-fuchsia-600 text-white font-semibold py-3 px-6 rounded-lg"
  >
  {{ (isSubmitting$| async) ? 'Creating in Jira....' : 'Create in Jira'}}
</button>
      <!-- Success Message -->
      <app-alert *ngIf="isSuccess$ | async" type="success">
        Successfully created items in Jira!
      </app-alert>

  </div>